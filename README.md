# juju-scripts

Scripts:

|            Name             | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | Parameters                                                                                                  | Usage example                                                                                                                                                                                      |
|:---------------------------:|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| juju_dp_rsync_charm_dir.sh  | Combines juju_rsync_charm_dir.sh and juju_ssh_repossess_dp_s3.sh scripts. Automatically determines `tests/integration` directory on the remote host.                                                                                                                                                                                                                                                                                                                                         | 1: directory on current host to upload<br/><br/>2: remote ssh host<br/><br/>3: remote host upload directory | `juju_dp_rsync_charm_dir.sh $PWD lawson Work/Canonical`                                                                                                                                            |
| juju_dp_ssh_repossess_s3.sh | Specific to the [postgresql-operator](https://github.com/canonical/postgresql-operator) and [postgresql-k8s-operator](https://github.com/canonical/postgresql-k8s-operator) integration tests. Change GCP cloud entries to the AWS's. Optionally, change bucket and region to the `JUJU_SCRIPTS_REPOSSESS_DP_S3_BUCKET` and `JUJU_SCRIPTS_REPOSSESS_DP_S3_REGION` environment vars respectively. Uses `find` and `sed` commands and executes final command on the remote host through `ssh`. | 1: remote ssh host<br/><br/>2: directory to recursively process source files within on the remote host      | `JUJU_SCRIPTS_REPOSSESS_DP_S3_BUCKET="v-tarasenko" JUJU_SCRIPTS_REPOSSESS_DP_S3_REGION="eu-central-1" juju_dp_ssh_repossess_s3.sh lawson Work/Canonical/postgresql-k8s-operator/tests/integration` |
|        juju_myk8s.sh        | Same as juju_mylxd.sh, but for microk8s.                                                                                                                                                                                                                                                                                                                                                                                                                                                     | on / off                                                                                                    | `juju_myk8s.sh off`                                                                                                                                                                                |
|        juju_mylxd.sh        | **on**<br/>Connect juju to the lxd and change the default config for all the models: update-status interval to 60s + debug logging to enabled.<br/><br/>**off**<br/>Disconnect juju from the lxd with purging all of the data.                                                                                                                                                                                                                                                               | on / off                                                                                                    | `juju_mylxd.sh on`                                                                                                                                                                                 |
|    juju_psql_connect.sh     | Connect to the specified VM or K8s PostgreSQL unit using current host psql command.                                                                                                                                                                                                                                                                                                                                                                                                          | unit with numeric identifier                                                                                | `juju_psql_connect.sh postgresql/0`                                                                                                                                                                |
| juju_psql_run_pgmetrics.sh  | Download pgmetrics binary to `/tmp` and connect it to specified VM or K8s PostgreSQL unit.                                                                                                                                                                                                                                                                                                                                                                                                   | unit with numeric identifier                                                                                | `juju_psql_run_pgmetrics.sh postgresql-k8s/0`                                                                                                                                                      |
|   juju_psql_switchover.sh   | Perform PostgreSQL primary switchover from first unit to second one through Patroni.                                                                                                                                                                                                                                                                                                                                                                                                         | 1: primary unit<br/><br/>2: candidate unit                                                                  | `juju_psql_switchover.sh` postgresql/0 postgresql/1                                                                                                                                                |
|   juju_rsync_charm_dir.sh   | Alias for the rsync, but with ignoring typical non-src files.                                                                                                                                                                                                                                                                                                                                                                                                                                | [rsync quick guide](https://www.redhat.com/sysadmin/sync-rsync)                                             | `juju_rsync_charm_dir.sh $PWD lawson:Work/Canonical`                                                                                                                                               |
